<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> compiler optimizations (2) | Siddharth Narsipur </title> <meta name="author" content="Siddharth Narsipur"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://sidnarsipur.github.io/blog/2025/compiler2/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Siddharth</span> Narsipur </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/resume/">resume </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">compiler optimizations (2)</h1> <p class="post-meta"> Created in February 28, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/cs"> <i class="fa-solid fa-hashtag fa-sm"></i> cs</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Before we move on to covering dataflow analysis, I thought it would interesting to cover an example of such an analysis to motivate its discussion.</p> <h1 id="live-variable-analysis">Live Variable Analysis</h1> <p>A Control flow graph represents our source code in a data structure that allows us to analyze properties of our program very easily.</p> <p>For example, consider the C program that calculates the minimum of two numbers:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int minimum(int x, int y) {
    int r = -1;
  
    if(x &gt; y)
      r = y;
    else
      r = x;
  
    return r;
}
</code></pre></div></div> <p>In three-address form:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    r = -1
    t0 = x &gt; y
    if (t0 == 0)  goto L1
    r = y
    goto L0

L1:
    r = x
    goto L0

L0:
    return r

</code></pre></div></div> <p>In CFG form:</p> <p><br></p> <div align="center"> <img src="https://imgur.com/5j8LsJy.png" alt="CFG for minimum code" width="30%"> </div> <p><br></p> <p>At the return statement, what value of r is “alive”? Informally, a variable is alive after its definition upto a point in the program where it is re-defined on all possible paths.</p> <p>In the CFG above, we can see that <code class="language-plaintext highlighter-rouge">r = -1</code> is no longer alive at the return statement as all edges coming into the return statement have a write to r.</p> <p>Doing live variable analysis helps us remove unnecessary statements from the program while maintaining correctness. In this example, the <code class="language-plaintext highlighter-rouge">r = -1</code> assignment can be safely removed.</p> <p>How do we calculate live variables for more complex programs?</p> <p>At the level of a basic block, we need to define two sets: <code class="language-plaintext highlighter-rouge">DEF</code> and <code class="language-plaintext highlighter-rouge">USE</code>.</p> <p><code class="language-plaintext highlighter-rouge">DEF</code> is the set of variables written to in the block.</p> <p><code class="language-plaintext highlighter-rouge">USE</code> is the set of variables read from, before being written to, in the block.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BB001:
    x = 10
    y = z + 10

DEF(BB001) = {x, y}
USE(BB001) = {z}


BB002:
    a = 10 + j
    j = 25 + x

DEF(BB002) = {a, j}
USE(BB002) = {j, x}

BB003:
    x = 10
    j = x

DEF(BB003) = {x, j}
USE(BB003) = {} # x not included!
</code></pre></div></div> <p>Our goal is to calculate <code class="language-plaintext highlighter-rouge">IN</code> and <code class="language-plaintext highlighter-rouge">OUT</code>, the set of variables that are alive, entering and leaving, a basic block.</p> <p>Calculating <code class="language-plaintext highlighter-rouge">OUT</code> is easy - it’s just the union of all the <code class="language-plaintext highlighter-rouge">IN</code> sets in b’s successors.</p> <p><code class="language-plaintext highlighter-rouge">OUT(b) = ∪ (IN(s) for s in SUCC(b))</code></p> <p>Why don’t we define it the other way around? Take a moment and think about what <em>direction</em> facts flow in. Live variable analysis asks whether our variable is alive in the paths <em>after</em> ours, i.e., subsequent instructions. This means that facts flow from lower nodes to higher nodes, or backwards. Therefore, <code class="language-plaintext highlighter-rouge">OUT</code> is defined as a union of successor <code class="language-plaintext highlighter-rouge">IN</code> sets.</p> <p>Now let’s try and find <code class="language-plaintext highlighter-rouge">IN(b)</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BB009:
    x = 10 + y
</code></pre></div></div> <p>In the above example, <code class="language-plaintext highlighter-rouge">y</code> is in the <code class="language-plaintext highlighter-rouge">USE</code> set of <code class="language-plaintext highlighter-rouge">BB009</code> and hasn’t been defined in the same block. Therefore, <code class="language-plaintext highlighter-rouge">y</code> had to have been defined earlier in the program and has to be alive <em>entering</em> the block.</p> <p>That’s the first part of the formula: <code class="language-plaintext highlighter-rouge">IN(b) = USE(b)</code></p> <p>Vice versa, if a variable is alive in subsequent blocks without a definition, it has to have been alive in our block (remember that <code class="language-plaintext highlighter-rouge">OUT(b)</code> is defined on successors). <code class="language-plaintext highlighter-rouge">IN(b) = USE(b) ∪ OUT(b)</code></p> <p>However, there is a problem in this equation.</p> <p>If we re-define a variable within our block before it is read, it is no longer alive entering the block as the new definition will kill all of its previous definitions. We need to remove any variables in <code class="language-plaintext highlighter-rouge">DEF(b)</code> from <code class="language-plaintext highlighter-rouge">OUT(b)</code>. Now, a variable defined in a block only ends up in <code class="language-plaintext highlighter-rouge">IN(b)</code> if there was a read before the definition.</p> <p>This completes our equation: <code class="language-plaintext highlighter-rouge">IN(b) = USE(b) ∪ (OUT(b) - DEF(b))</code></p> <p>If you think of yourself as a block, the variable is alive coming in if I use it or any of my succesors use it, <em>unless</em> I define it myself.</p> <p>Wait? Aren’t <code class="language-plaintext highlighter-rouge">IN</code> and <code class="language-plaintext highlighter-rouge">OUT</code> dependent on each other? To fix that, we define a special node called <code class="language-plaintext highlighter-rouge">EXIT</code> whose <code class="language-plaintext highlighter-rouge">IN</code> set is initialized to be empty. This serves as the base case in the recursive equation.</p> <p>To calculate the <code class="language-plaintext highlighter-rouge">IN</code> and <code class="language-plaintext highlighter-rouge">OUT</code> set for each block, we can start from any block, and begin solving the equations for each block in our CFG. We stop when we reach a <em>fixpoint</em> - a round of iteration on the CFG where none of the <code class="language-plaintext highlighter-rouge">IN</code> sets have changed.</p> <p>Let us run through an example of live variable analysis. Consider the CFG below where <code class="language-plaintext highlighter-rouge">BB001</code> has an edge to <code class="language-plaintext highlighter-rouge">BB002</code>, which has an edge to <code class="language-plaintext highlighter-rouge">BB003</code>.</p> <p>For backwards analysis, we usually begin with the last node (<code class="language-plaintext highlighter-rouge">BB003</code> in this example)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BB001:
    a = 3; 
    b = 5;
    d = 4;
    x = 100;  

BB002: 
    c = a + b;
    d = 2;

BB003: 
    c = 4;
    return b * d + c;

    DEF(BB003) = {c}
    USE(BB003) = {b, d}

    OUT(BB003) = {} [Remember: IN(EXIT) = {}]
    IN(BB003) = {b, d, c} ∪ ({} - {c}) = {b, d}
</code></pre></div></div> <p>We then move onto <code class="language-plaintext highlighter-rouge">BB002</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BB001:
    a = 3; 
    b = 5;
    d = 4;
    x = 100;  

BB002: 
    c = a + b;
    d = 2;

    DEF(BB002) = {c, d}
    USE(BB002) = {a, b}

    OUT(BB003) = {b, d} [from IN(BB003)]
    IN(BB003) = {a, b} ∪ ({b, d} - {c, d}) = {a, b}

BB003: 
    c = 4;
    return b * d + c;

    OUT(BB003) = {}
    IN(BB003) = {b, d}
</code></pre></div></div> <p>We then move onto <code class="language-plaintext highlighter-rouge">BB001</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BB001:
    a = 3; 
    b = 5;
    d = 4;
    x = 100;  

    DEF(BB001) = {a, b, d, x}
    USE(BB001) = {}

    OUT(BB003) = {a, b} [from IN[BB002]]
    IN(BB003) = {} ∪ ({a, b} - {a, b, d, x}) = {}

BB002: 
    c = a + b;
    d = 2;

    OUT(BB003) = {b, d}
    IN(BB003) = {a, b}

BB003: 
    c = 4;
    return b * d + c;

    OUT(BB003) = {}
    IN(BB003) = {b, d}
</code></pre></div></div> <p>Since this CFG is a single chain, we are done. However, if our CFG contained multiple join nodes, we would need to run multiple iterations of equation solving until we reach a fixpoint. These iterations of solving equations is known as iterative dataflow analysis.</p> <p>Analyzing the <code class="language-plaintext highlighter-rouge">OUT</code> sets from the example lets us remove many instructions and derive an equivalent program.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BB001:
    a = 3; 
    b = 5;  

BB002: 
    d = 2;

BB003: 
    c = 4;
    return b * d + c;
</code></pre></div></div> <p>Live variable analysis removed three instructions in this simple program!</p> <p>It is important to note that due to the way we have setup the <code class="language-plaintext highlighter-rouge">IN</code> and <code class="language-plaintext highlighter-rouge">OUT</code> equations, we will <em>always</em> reach a fixpoint as the size of the <code class="language-plaintext highlighter-rouge">OUT</code> set can only increase (monotonic non-decreasing), and there is a finite bound to its size (the set of variables in the source code).</p> <p>We can formally prove such properties using dataflow analysis, which I will talk about in the next post. Live variable analysis is an example of a dataflow analysis, which uses <em>backwards</em> iteration and a <em>union</em> meet operator.</p> <p>Disclaimer: I am not an expert in compilers, and just want to share some cool ideas I’ve been learning. If I’ve made an error somewhere, <a href="mailto:sid.narsipur@gmail.com">let me know</a>.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/compiler/">compiler optimizations (1)</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Siddharth Narsipur. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>